<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#004b6b" />
  <title>Calculadora de Magnitud Sísmica</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f4f7; }
    .card { background: white; padding: 20px; border-radius: 16px; max-width: 430px; margin: 20px auto; box-shadow: 0 3px 10px rgba(0,0,0,0.12); }
    h2 { margin-top: 0; color: #004b6b; text-align: center; }
    label { display: block; margin-top: 12px; font-weight: bold; font-size: 14px; }
    input { width: 100%; padding: 8px 10px; margin-top: 4px; border-radius: 8px; border: 1px solid #ccd3da; box-sizing: border-box; }
    button { margin-top: 18px; width: 100%; padding: 12px; background: #004b6b; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; }
    button:hover { background: #003c57; }
    .resultado { margin-top: 14px; font-size: 18px; font-weight: bold; text-align: center; color: #222; }
    .nota { margin-top: 8px; font-size: 12px; color: #555; text-align: center; }
    svg { width: 100%; height: 420px; margin-top: 18px; background: #f8fafc; border-radius: 12px; border: 1px solid #dde3ea; }
    .axis-label { font-size: 11px; fill: #222; }
    .tick-label { font-size: 9px; fill: #444; }
    .axis-line { stroke: #555; stroke-width: 1; }
    .guide-line { stroke: #999; stroke-width: 0.5; stroke-dasharray: 3 3; }
    .mag-line { stroke: #c62828; stroke-width: 2; }
    .point { fill: #c62828; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Calculadora de Magnitud (ML)</h2>

    <label for="p">Tiempo de arribo P (s)</label>
    <input type="number" id="p" step="0.01" />

    <label for="s">Tiempo de arribo S (s)</label>
    <input type="number" id="s" step="0.01" />

    <label for="amp">Amplitud máxima (mm)</label>
    <input type="number" id="amp" step="0.01" />

    <button onclick="calcularML()">Calcular magnitud y trazar recta</button>

    <div class="resultado" id="resultado"></div>
    <div class="nota">Se usa una fórmula aproximada de magnitud local tipo Richter.</div>

    <svg id="nomograma" viewBox="0 0 320 420">
      <!-- Ejes y elementos se dibujan con JavaScript -->
      <g id="axes"></g>
      <g id="plot"></g>
    </svg>

    <h3 style="text-align:center; color:#004b6b; margin-top:25px;">Sismogramas</h3>
    <p style="font-size:12px; text-align:center; color:#444; margin-top:0;">Lecturas para el ejercicio</p>

    <img src="ARIG.jpg" alt="Sismograma ARIG" style="width:100%; margin-top:15px; border-radius:12px; border:1px solid #ccc;">
    <img src="CMIG.jpg" alt="Sismograma CMIG" style="width:100%; margin-top:15px; border-radius:12px; border:1px solid #ccc;">
    <img src="MOIG.jpg" alt="Sismograma MOIG" style="width:100%; margin-top:15px; border-radius:12px; border:1px solid #ccc;">

  </div>

  <script>
    const dMin = 20;   // km
    const dMax = 600;  // km
    const aMin = 0.1;  // mm
    const aMax = 200;  // mm
    const mMin = 0;
    const mMax = 8;

    const svgHeight = 420;
    const topMargin = 30;
    const bottomMargin = 40;
    const axisHeight = svgHeight - topMargin - bottomMargin;

    const xDist = 50;
    const xMag  = 160;
    const xAmp  = 270;

    function yFromLog(value, vMin, vMax) {
      const logMin = Math.log10(vMin);
      const logMax = Math.log10(vMax);
      const t = (Math.log10(value) - logMin) / (logMax - logMin);
      return topMargin + (1 - t) * axisHeight;
    }

    function yFromLinear(value, vMin, vMax) {
      const t = (value - vMin) / (vMax - vMin);
      return topMargin + (1 - t) * axisHeight;
    }

    function drawAxes() {
      const svg = document.getElementById("nomograma");
      const axes = document.getElementById("axes");
      axes.innerHTML = "";
      const ns = "http://www.w3.org/2000/svg";

      // Ejes principales
      const distAxis = document.createElementNS(ns, "line");
      distAxis.setAttribute("x1", xDist);
      distAxis.setAttribute("x2", xDist);
      distAxis.setAttribute("y1", topMargin);
      distAxis.setAttribute("y2", topMargin + axisHeight);
      distAxis.setAttribute("class", "axis-line");
      axes.appendChild(distAxis);

      const magAxis = document.createElementNS(ns, "line");
      magAxis.setAttribute("x1", xMag);
      magAxis.setAttribute("x2", xMag);
      magAxis.setAttribute("y1", topMargin);
      magAxis.setAttribute("y2", topMargin + axisHeight);
      magAxis.setAttribute("class", "axis-line");
      axes.appendChild(magAxis);

      const ampAxis = document.createElementNS(ns, "line");
      ampAxis.setAttribute("x1", xAmp);
      ampAxis.setAttribute("x2", xAmp);
      ampAxis.setAttribute("y1", topMargin);
      ampAxis.setAttribute("y2", topMargin + axisHeight);
      ampAxis.setAttribute("class", "axis-line");
      axes.appendChild(ampAxis);

      // Etiquetas de ejes
      const distLabel = document.createElementNS(ns, "text");
      distLabel.setAttribute("x", xDist);
      distLabel.setAttribute("y", 18);
      distLabel.setAttribute("text-anchor", "middle");
      distLabel.setAttribute("class", "axis-label");
      distLabel.textContent = "DISTANCIA (km)";
      axes.appendChild(distLabel);

      const magLabel = document.createElementNS(ns, "text");
      magLabel.setAttribute("x", xMag);
      magLabel.setAttribute("y", 18);
      magLabel.setAttribute("text-anchor", "middle");
      magLabel.setAttribute("class", "axis-label");
      magLabel.textContent = "MAGNITUD";
      axes.appendChild(magLabel);

      const ampLabel = document.createElementNS(ns, "text");
      ampLabel.setAttribute("x", xAmp);
      ampLabel.setAttribute("y", 18);
      ampLabel.setAttribute("text-anchor", "middle");
      ampLabel.setAttribute("class", "axis-label");
      ampLabel.textContent = "AMPLITUD (mm)";
      axes.appendChild(ampLabel);

      // Ticks distancia (log)
      const distTicks = [20, 30, 50, 100, 200, 300, 500];
      distTicks.forEach(v => {
        const y = yFromLog(v, dMin, dMax);
        const tick = document.createElementNS(ns, "line");
        tick.setAttribute("x1", xDist - 4);
        tick.setAttribute("x2", xDist + 4);
        tick.setAttribute("y1", y);
        tick.setAttribute("y2", y);
        tick.setAttribute("class", "axis-line");
        axes.appendChild(tick);

        const label = document.createElementNS(ns, "text");
        label.setAttribute("x", xDist - 8);
        label.setAttribute("y", y + 3);
        label.setAttribute("text-anchor", "end");
        label.setAttribute("class", "tick-label");
        label.textContent = v;
        axes.appendChild(label);
      });

      // Ticks magnitud (lineal)
      for (let m = mMin; m <= mMax; m += 1) {
        const y = yFromLinear(m, mMin, mMax);
        const tick = document.createElementNS(ns, "line");
        tick.setAttribute("x1", xMag - 4);
        tick.setAttribute("x2", xMag + 4);
        tick.setAttribute("y1", y);
        tick.setAttribute("y2", y);
        tick.setAttribute("class", "axis-line");
        axes.appendChild(tick);

        const label = document.createElementNS(ns, "text");
        label.setAttribute("x", xMag + 8);
        label.setAttribute("y", y + 3);
        label.setAttribute("text-anchor", "start");
        label.setAttribute("class", "tick-label");
        label.textContent = m.toString();
        axes.appendChild(label);
      }

      // Ticks amplitud (log)
      const ampTicks = [0.1, 0.2, 0.5, 1, 2, 5, 10, 20, 50, 100, 200];
      ampTicks.forEach(v => {
        const y = yFromLog(v, aMin, aMax);
        const tick = document.createElementNS(ns, "line");
        tick.setAttribute("x1", xAmp - 4);
        tick.setAttribute("x2", xAmp + 4);
        tick.setAttribute("y1", y);
        tick.setAttribute("y2", y);
        tick.setAttribute("class", "axis-line");
        axes.appendChild(tick);

        const label = document.createElementNS(ns, "text");
        label.setAttribute("x", xAmp + 8);
        label.setAttribute("y", y + 3);
        label.setAttribute("text-anchor", "start");
        label.setAttribute("class", "tick-label");
        label.textContent = v;
        axes.appendChild(label);
      });
    }

    function calcularML() {
      const tP = parseFloat(document.getElementById("p").value);
      const tS = parseFloat(document.getElementById("s").value);
      const A  = parseFloat(document.getElementById("amp").value);
      const resDiv = document.getElementById("resultado");

      if (isNaN(tP) || isNaN(tS) || isNaN(A)) {
        resDiv.textContent = "Por favor llena todos los campos.";
        limpiarGrafica();
        return;
      }

      const SP = tS - tP;
      if (SP <= 0) {
        resDiv.textContent = "El tiempo S debe ser mayor que el tiempo P.";
        limpiarGrafica();
        return;
      }

      const distancia = SP * 8; // km
      if (distancia < dMin || distancia > dMax || A < aMin || A > aMax) {
        resDiv.textContent = "Valores fuera del rango del nomograma (distancia 20–600 km, amplitud 0.1–200 mm).";
        limpiarGrafica();
        return;
      }

      // Fórmula aproximada de magnitud local tipo Richter: ML = log10(A) + 3 log10(Δ) - 2.92
      const ML = Math.log10(A) + 3 * Math.log10(distancia) - 2.92;
      resDiv.textContent = `Magnitud estimada: ${ML.toFixed(2)}`;

      dibujarLinea(distancia, A, ML);
    }

    function limpiarGrafica() {
      const plot = document.getElementById("plot");
      plot.innerHTML = "";
    }

    function dibujarLinea(distancia, amplitud, ML) {
      const plot = document.getElementById("plot");
      plot.innerHTML = "";
      const ns = "http://www.w3.org/2000/svg";

      const yDist = yFromLog(distancia, dMin, dMax);
      const yAmp  = yFromLog(amplitud, aMin, aMax);
      const yMag  = yFromLinear(ML, mMin, mMax);

      // Línea que une distancia y amplitud
      const line = document.createElementNS(ns, "line");
      line.setAttribute("x1", xDist);
      line.setAttribute("y1", yDist);
      line.setAttribute("x2", xAmp);
      line.setAttribute("y2", yAmp);
      line.setAttribute("class", "mag-line");
      plot.appendChild(line);

      // Proyección de la recta sobre el eje de magnitud (intersección)
      // Para simplificar, dibujamos una línea guía horizontal en la magnitud calculada
      const guide = document.createElementNS(ns, "line");
      guide.setAttribute("x1", xDist);
      guide.setAttribute("y1", yMag);
      guide.setAttribute("x2", xAmp);
      guide.setAttribute("y2", yMag);
      guide.setAttribute("class", "guide-line");
      plot.appendChild(guide);

      // Punto en el eje de magnitud
      const magPoint = document.createElementNS(ns, "circle");
      magPoint.setAttribute("cx", xMag);
      magPoint.setAttribute("cy", yMag);
      magPoint.setAttribute("r", 4);
      magPoint.setAttribute("class", "point");
      plot.appendChild(magPoint);
    }

    // Registrar service worker para PWA
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("sw.js").catch(err => {
          console.log("SW no registrado", err);
        });
      });
    }

    document.addEventListener("DOMContentLoaded", drawAxes);
  </script>
  <!-- Modal para zoom de imágenes -->
  <div id="imgModal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center;">
    <img id="modalImg" src="" style="max-width:90%; max-height:90%; border-radius:12px;">
  </div>

  <script>
    // Activar zoom al tocar una imagen
    document.querySelectorAll("img").forEach(img => {
      img.style.cursor = "zoom-in";
      img.addEventListener("click", () => {
        document.getElementById("modalImg").src = img.src;
        document.getElementById("imgModal").style.display = "flex";
      });
    });

    // Cerrar el zoom al tocar afuera
    document.getElementById("imgModal").addEventListener("click", () => {
      document.getElementById("imgModal").style.display = "none";
    });
  </script>
</body>
</html>

